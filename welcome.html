<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>×‘×¨×•×š ×”×‘× ×œ×©×™×¨×•×ª ×”×¢×ª×™×“ ×©×œ ×—.×¡×‘×Ÿ!</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <style>
        :root {
            --whatsapp-bg: #E5DDD5;
            --app-bg: #F0F2F5;
            --header-bg: #008069;
            --text-dark: #111b21;
            --text-light: #667781;
            --outgoing-bubble: #E7FFDB;
            --incoming-bubble: #FFFFFF;
            --system-bubble: #E1F2FB;
            --brand-green: #075E54;
            --success: #25D366;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes nudge { 0%, 100% { transform: scale(1.1) rotate(10deg); } 50% { transform: scale(1.2) rotate(-10deg); } }
        @keyframes typing { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }

        body { font-family: 'Assistant', sans-serif; margin: 0; background-color: #d1d7db; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .app-container { width: 100%; height: 100%; max-width: 420px; background-color: var(--whatsapp-bg); background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        @media (min-width: 450px) { .app-container { max-height: 90vh; border-radius: 20px; } }

        .chat-header { background-color: var(--header-bg); color: white; display: flex; align-items: center; padding: 10px 15px; gap: 15px; flex-shrink: 0; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; }
        .header-info h1 { font-size: 1.1rem; margin: 0; font-weight: 700; }
        .header-info p { font-size: 0.8rem; margin: 0; opacity: 0.8; }

        .chat-canvas { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .message-bubble { max-width: 85%; padding: 8px 12px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 1px 1px rgba(0,0,0,0.08); animation: fadeIn 0.4s ease-out; position: relative; }
        .message-bubble.outgoing { background-color: var(--outgoing-bubble); align-self: flex-end; }
        .message-bubble.incoming { background-color: var(--incoming-bubble); align-self: flex-start; }
        .message-bubble.system { background-color: var(--system-bubble); align-self: center; font-size: 0.85rem; }
        
        .typing-indicator { align-self: flex-start; }
        .typing-indicator .dots { display: flex; gap: 5px; background: var(--incoming-bubble); padding: 12px 15px; border-radius: 8px; }
        .typing-indicator .dots span { width: 8px; height: 8px; border-radius: 50%; background-color: #8E8E8E; animation: typing 1.4s infinite; }
        .typing-indicator .dots span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator .dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator .dots span:nth-child(3) { animation-delay: 0.4s; }

        .order-draft { background: #f0f8ff; border-left: 4px solid var(--brand); padding: 15px; border-radius: 8px; margin-top: 10px; font-family: monospace; font-size: 13px; text-align: left; }
        .order-draft b { color: var(--brand); }
        
        .permission-card { text-align: center; }
        .permission-card h3 { margin-bottom: 10px; font-size: 1.1rem; }
        .permission-icon { font-size: 3rem; margin-bottom: 10px; color: var(--brand); }
        .finger-pointer { font-size: 2rem; animation: nudge 1.5s infinite; display: block; margin: 0 auto 5px auto; transform: rotate(180deg); }
        .permission-button { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 1rem; cursor: pointer; font-weight: 700; }
        .prompt-example { max-width: 80%; border-radius: 8px; margin-top: 15px; border: 1px solid #ddd; }

        .cta-button { display: inline-block; background: var(--success); color: white; padding: 12px 25px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; text-decoration: none; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="chat-header">
            <div class="avatar"><img src="https://i.postimg.cc/2SbDgD1B/1.png" alt="×œ×•×’×• ×—.×¡×‘×Ÿ"></div>
            <div class="header-info">
                <h1>×”×¢×•×–×¨ ×”××™×©×™ ×©×œ ×—.×¡×‘×Ÿ</h1>
                <p>×–××™×Ÿ ×¢×›×©×™×•</p>
            </div>
        </header>

        <main class="chat-canvas" id="chat-canvas"></main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('chat-canvas');
            const params = new URLSearchParams(window.location.search);
            const name = params.get('name') || '×œ×§×•×—';
            const clientId = params.get('id');
            const mainAppUrl = `https://ap-saban94.netlify.app/index.html?id=${clientId || ''}`;

            const animationSteps = [
                { type: 'system', text: `×©×œ×•× ${name}, ×‘×¨×•×š ×”×‘× ×œ×©×™×¨×•×ª ×”×”×–×× ×•×ª ×”×—×“×©!` },
                { type: 'incoming', text: '×× ×™ ×”×¢×•×–×¨ ×”××™×©×™ ×©×œ×š, ×•×× ×™ ×›××Ÿ ×›×“×™ ×œ×—×¡×•×š ×œ×š ×–××Ÿ ×™×§×¨.' },
                { type: 'incoming', text: '× ×××¡ ×œ×š ×œ×”××ª×™×Ÿ ×¢×œ ×”×§×•? â˜ï¸\n×¦×¤×” ×‘×§×¡× ×”×‘×... âœ¨' },
                { type: 'outgoing', text: '×”×™×™, ×¦×¨×™×š ×“×—×•×£:\n75 ×‘×œ×•×§ 10, ××©×œ×•×— ×œ×”×–×•×”×¨ 10 ×ª"×, 20 ××œ×˜, 50 ×©×§ ×“×‘×§, ××™×© ×§×©×¨ ××¡×£ 0521234567' },
                { type: 'typing' },
                { type: 'incoming', text: '×§×™×‘×œ×ª×™! ×”× ×” ××” ×©×”×‘× ×ª×™ ××”×¨×©×™××” ×©×œ×š:', draft: true },
                { type: 'incoming', text: '×‘×©×œ×‘ ×”×‘×, × ××©×¨ ×”×¨×©××•×ª ×›×“×™ ×©××•×›×œ ×œ×¢×“×›×Ÿ ××•×ª×š ×‘×–××Ÿ ×××ª.', permission: 'notifications' },
                { type: 'incoming', text: '××¢×•×œ×”. ×•×œ×¡×™×•×, ××™×©×•×¨ ×§×˜×Ÿ ×œ×©×™××•×© ×‘××™×§×•× ×™×¢×–×•×¨ ×œ×™ ×œ×–×”×•×ª ××ª ×›×ª×•×‘×ª ×”×¤×¨×•×™×§×˜ ××•×˜×•××˜×™×ª.', permission: 'location' },
                { type: 'incoming', text: `×”×›×œ ××•×›×Ÿ, ${name}! ×‘×§×¨×•×‘ ×ª×©×•×“×¨×’ ×œ×š ×’×¨×¡×” ×—×“×©×” ×¢× ×›×œ×™× ×‘×œ×¢×“×™×™×. ×‘×™× ×ª×™×™×, ×‘×•× × ×ª×—×™×œ.` },
                { type: 'cta' }
            ];
            
            let currentStep = 0;

            function runAnimation() {
                if (currentStep >= animationSteps.length) return;
                const step = animationSteps[currentStep];

                let delay = step.type === 'typing' ? 2500 : 1500;
                if (step.text && step.text.length > 50) delay = 2000;
                
                if (step.type === 'typing') {
                    addTypingIndicator();
                } else {
                    addMessageBubble(step);
                }

                currentStep++;
                setTimeout(runAnimation, delay);
            }
            
            function addMessageBubble(step) {
                const bubble = document.createElement('div');
                bubble.className = `message-bubble ${step.type}`;
                
                let content = step.text;

                if (step.draft) {
                    content += `<div class="order-draft">
<b>×˜×™×•×˜×” ×–×•×”×ª×”:</b><br>
- <b>×›×ª×•×‘×ª:</b> ×”×–×•×”×¨ 10 ×ª"×<br>
- <b>××™×© ×§×©×¨:</b> ××¡×£ (0521234567)<br>
- <b>×¤×¨×™×˜:</b> ×‘×œ×•×§ 10 (75 ×™×—')<br>
- <b>×¤×¨×™×˜:</b> ××œ×˜ (20 ×™×—')<br>
- <b>×¤×¨×™×˜:</b> ×©×§ ×“×‘×§ (50 ×™×—')
                    </div>`;
                }
                
                if (step.permission === 'notifications') {
                    content += `<div class="permission-card">
                        <div class="permission-icon">ğŸ””</div>
                        <h3>×”×ª×¨××•×ª Push</h3>
                        <span class="finger-pointer">ğŸ‘‡</span>
                        <button class="permission-button" id="notify-btn">××©×¨ ×§×‘×œ×ª ×”×ª×¨××•×ª</button>
                        <img src="https://www.y4pc.co.il/wp-content/uploads/2018/11/how-to-block-notifications-from-websites23.jpg" alt="×“×•×’××ª ××™×©×•×¨ ×”×¨×©××•×ª" class="prompt-example">
                    </div>`;
                }
                
                if (step.permission === 'location') {
                     content += `<div class="permission-card">
                        <div class="permission-icon">ğŸ“</div>
                        <h3>×©×™×¨×•×ª×™ ××™×§×•×</h3>
                        <span class="finger-pointer">ğŸ‘‡</span>
                        <button class="permission-button" id="location-btn">××©×¨ ×©×™××•×© ×‘××™×§×•×</button>
                    </div>`;
                }

                if (step.type === 'cta') {
                    bubble.style.background = 'none';
                    bubble.style.boxShadow = 'none';
                    bubble.style.alignSelf = 'center';
                    content = `<a href="${mainAppUrl}" class="cta-button">×”×‘× ×ª×™, ×‘×•× × ×ª×—×™×œ!</a>`;
                }
                
                bubble.innerHTML = content;
                canvas.appendChild(bubble);
                scrollToBottom();

                // Add event listeners after element is in DOM
                if (step.permission === 'notifications') document.getElementById('notify-btn').addEventListener('click', askForNotificationPermission);
                if (step.permission === 'location') document.getElementById('location-btn').addEventListener('click', askForLocationPermission);
            }

            function addTypingIndicator() {
                const existing = document.getElementById('typing-indicator');
                if (existing) existing.remove();
                
                const bubble = document.createElement('div');
                bubble.id = 'typing-indicator';
                bubble.className = 'message-bubble typing-indicator';
                bubble.innerHTML = `<div class="dots"><span></span><span></span><span></span></div>`;
                canvas.appendChild(bubble);
                scrollToBottom();
            }

            function scrollToBottom() {
                canvas.scrollTop = canvas.scrollHeight;
            }

            function askForNotificationPermission() {
                if (window.OneSignalDeferred) {
                    window.OneSignalDeferred.push(function(OneSignal) {
                        OneSignal.Slidedown.prompt();
                    });
                } else { alert('OneSignal SDK not ready.'); }
            }

            function askForLocationPermission() {
                 if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => alert('âœ… ×ª×•×“×”! ××™×©×¨×ª ×©×™××•×© ×‘××™×§×•×.'),
                        (err) => alert('×‘×§×©×ª ×”××™×§×•× × ×“×—×ª×”. ×ª×•×›×œ ×œ××©×¨ ××•×ª×” ×™×“× ×™×ª ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ.')
                    );
                } else { alert('×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×©×™×¨×•×ª×™ ××™×§×•×.'); }
            }

            // Start the animation
            setTimeout(runAnimation, 500);
        });
    </script>
</body>
</html>

